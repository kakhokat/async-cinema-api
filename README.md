üé¨ Async Cinema API (Sprint 1)

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API –¥–ª—è –æ–Ω–ª–∞–π–Ω-–∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞: FastAPI + Elasticsearch + Redis.
–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è 1 —Å–ø—Ä–∏–Ω—Ç–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è (—Ç–æ–ª—å–∫–æ —Ñ–∏–ª—å–º—ã).

üì¶ –°–æ—Å—Ç–∞–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

src/ ‚Äî –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

tests/ ‚Äî –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã (pytest)

data/ ‚Äî mapping –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è Elasticsearch

scripts/es_load.py ‚Äî —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ ES

docker-compose.yml ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (API, Elasticsearch, Redis)

Dockerfile ‚Äî –æ–±—Ä–∞–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

requirements.txt, requirements-dev.txt ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (runtime/dev)

.env.example ‚Äî –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

.github/workflows/ci.yml ‚Äî CI

üìÑ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

–û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è —Ñ–∏–ª—å–º–æ–≤ –ø–æ –¢–ó —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:

–°–ø–∏—Å–æ–∫ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π, –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –∂–∞–Ω—Ä—É
GET /api/v1/films?sort=-imdb_rating&page_size=&page_number=&genre=

–ü–æ–∏—Å–∫ –ø–æ —Ñ–∏–ª—å–º–∞–º
GET /api/v1/films/search?query=... –∏ GET /api/v1/films/search/?query=...

–ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Ñ–∏–ª—å–º–∞
GET /api/v1/films/{uuid}

–û—Ç–≤–µ—Ç—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ Redis:

–¥–µ—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ ‚Äî –ø–æ id, TTL 5 –º–∏–Ω—É—Ç;

—Å–ø–∏—Å–∫–∏ –∏ –ø–æ–∏—Å–∫ ‚Äî –ø–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞, TTL 5 –º–∏–Ω—É—Ç.

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (Swagger): http://localhost:8000/api/openapi

–°—Ç–µ–∫ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Docker.

–ü–µ—Ä—Å–æ–Ω—ã –∏ –∂–∞–Ω—Ä—ã –≤ —Ä–∞–º–∫–∞—Ö –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –æ–ø—É—â–µ–Ω—ã (–ø–æ —É—Å–ª–æ–≤–∏—é —Å–ø—Ä–∏–Ω—Ç–∞).

‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

Docker / Docker Compose

Python 3.11 (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –∑–∞–ø—É—Å–∫–∞—Ç—å scripts/es_load.py —Å —Ö–æ—Å—Ç–∞)

üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Docker)

–ù–∏–∂–µ –∫–æ–º–∞–Ω–¥—ã —Å–≤–µ–¥–µ–Ω—ã –≤ –æ–¥–∏–Ω —Å—Ü–µ–Ω–∞—Ä–∏–π ¬´–ø–æ–¥–Ω–∏–º–∞–π –∏ –ø—Ä–æ–≤–µ—Ä—è–π —á–µ—Ä–µ–∑ Swagger –∏ –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã¬ª.

–ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π–¥–∏ –≤ –Ω–µ–≥–æ:

git clone https://github.com/kakhokat/async-cinema-api.git
cd async-cinema-api


(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –°–æ–∑–¥–∞–π .env:

cp .env.example .env


–ü–æ–¥–Ω–∏–º–∏ —Å—Ç–µ–∫:

docker compose up -d --build


–ó–∞–ª–µ–π —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ ES:

# 1) —Å–æ–∑–¥–∞—Ç—å –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
docker compose exec -e ELASTIC_URL=http://elasticsearch:9200 -e ES_INDEX=movies api python scripts/es_load.py

–û—Ç–∫—Ä–æ–π Swagger:

http://localhost/api/openapi


–ü—Ä–æ–≤–µ—Ä—å —Ä—É—á–∫–∏ –≤ Swagger (–∏–ª–∏ curl):

–°–ø–∏—Å–æ–∫ (–ø–æ–ø—É–ª—è—Ä–Ω—ã–µ):

GET http://localhost:8000/api/v1/films?sort=-imdb_rating&page_size=50&page_number=1


–ü–æ–∏—Å–∫:

GET http://localhost:8000/api/v1/films/search?query=star&page_size=50&page_number=1
GET http://localhost:8000/api/v1/films/search/?query=star&page_size=50&page_number=1


–î–µ—Ç–∞–ª—å–Ω–∞—è:

GET http://localhost:8000/api/v1/films/b31592e5-673d-46dc-a561-9446438aea0f


‚ö†Ô∏è –í–∞–∂–Ω–æ: Swagger —É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –ø—É—Ç–∏ /api/openapi, –∞ –Ω–µ /docs.

üß™ –ê–≤—Ç–æ—Ç–µ—Å—Ç—ã (pytest) —á–µ—Ä–µ–∑ Docker

–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

docker compose exec api sh -lc "pytest -q --maxfail=1 --disable-warnings"